<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Base-8 Word Generator</title>

<style>
body {
    font-family: sans-serif;
}

.controls {
    margin-bottom: 12px;
    padding: 10px;
    border: 1px solid #ccc;
    display: inline-block;
}

label {
    margin-right: 10px;
}

button {
    margin-left: 6px;
}

.notice {
    margin-top: 8px;
    color: #a00;
    font-size: 13px;
}

table {
    border-collapse: collapse;
    font-size: 12px;
    margin-top: 10px;
}

td {
    border: 1px solid #ccc;
    padding: 4px 6px;
    text-align: center;
    white-space: nowrap;
}

.name {
    color: #666;
    font-style: italic;
}

.output {
    margin-top: 10px;
    font-weight: bold;
}
</style>

<script>
function isValidBase8(value) {
    return /^[0-7]+$/.test(value);
}

function generate() {
    const rInput = document.getElementById("row").value;
    const cInput = document.getElementById("col").value;
    const makeTable = document.getElementById("makeTable").checked;
    const allowCombine = document.getElementById("combineMagnitudes").checked;

    const wordOut = document.getElementById("wordOutput");
    const tableOut = document.getElementById("tableContainer");
    const notice = document.getElementById("notice");

    wordOut.innerHTML = "";
    tableOut.innerHTML = "";
    notice.innerHTML = "";

    if (!isValidBase8(rInput) || !isValidBase8(cInput)) {
        wordOut.innerText = "Inputs must be base-8 numbers (0–7).";
        return;
    }

    const r = parseInt(rInput, 8);
    const c = parseInt(cInput, 8);

    if (r < 1 || c < 1) {
        wordOut.innerText = "Values must be ≥ 1.";
        return;
    }

    const product = r * c;
    const base8 = product.toString(8);

    const maxPower = base8.length - 1;
    if (maxPower >= 4 && !allowCombine) {
        notice.innerHTML =
            "⚠ No native words exist for 10<sup>4</sup> and above. " +
            "Check “Combine previous magnitudes” to proceed.";
        return;
    }

    const name = nameBase8(base8, allowCombine);

    wordOut.innerHTML =
        `${rInput} × ${cInput} = ${base8} <span class="name">(${name})</span>`;

    if (!makeTable) return;

    let html = "<table>";

    for (let i = 1; i <= r; i++) {
        html += "<tr>";
        for (let j = 1; j <= c; j++) {
            const b8 = (i * j).toString(8);
            const p = b8.length - 1;

            if (p >= 4 && !allowCombine) {
                html += "<td>—</td>";
                continue;
            }

            const n = nameBase8(b8, allowCombine);
            html += `<td>${b8} <span class="name">(${n})</span></td>`;
        }
        html += "</tr>";
    }

    html += "</table>";
    tableOut.innerHTML = html;
}

function nameBase8(octal, allowCombine) {
    const digits = {
        "1": "un",
        "2": "do",
        "3": "tri",
        "4": "ko",
        "5": "fos",
        "6": "hix",
        "7": "sip"
    };

    const magnitudes = {
        1: "kan",
        2: "stak",
        3: "miku"
    };

    let parts = [];
    const len = octal.length;

    for (let i = 0; i < len; i++) {
        const ch = octal[i];
        if (ch === "0") continue;

        let power = len - i - 1;

        if (power > 0) {
            let mag = "";

            if (power <= 3) {
                mag = magnitudes[power];
            } else if (allowCombine) {
                const m3 = Math.floor(power / 3);
                const rem = power % 3;
                mag = "miku".repeat(m3);
                if (rem > 0) mag += magnitudes[rem];
            } else {
                return "—";
            }

            if (ch === "1" && power === 1) {
                parts.push("o" + mag);
            } else if (ch === "1") {
                parts.push(mag);
            } else {
                parts.push(digits[ch] + mag);
            }
        } else {
            parts.push(digits[ch]);
        }
    }

    return smoothConsonants(parts.join(""));
}

function smoothConsonants(word) {
    if (!word) return "";
    let result = word[0];
    for (let i = 1; i < word.length; i++) {
        if (word[i] !== result[result.length - 1]) {
            result += word[i];
        }
    }
    return result;
}
</script>
</head>

<body>

<div class="controls">
    <label>
        Row (base-8):
        <input id="row" value="3">
    </label>
    <label>
        Column (base-8):
        <input id="col" value="4">
    </label>
    <label>
        <input type="checkbox" id="makeTable">
        Generate Table
    </label>
    <label>
        <input type="checkbox" id="combineMagnitudes">
        Combine previous magnitudes
    </label>
    <button onclick="generate()">Generate</button>
</div>

<div id="notice" class="notice"></div>
<div id="wordOutput" class="output"></div>
<div id="tableContainer"></div>

</body>
</html>
